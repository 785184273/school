function getinfo(){this.getId=function(e){return document.getElementById(e)},this.getClassName=function(e){return document.getElementsByClassName(e)},this.getTagName=function(e){return document.getElementsByTagName(e)},this.createTag=function(e){return document.createElement(e)},this.createText=function(e){return document.createTextNode(e)}}function ajaxshow(method,url){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4==xhr.readyState){eval("var val = "+xhr.responseText);var len=val.length,s="<tr>";s+="<td><strong>URL</strong></td>",s+="<td><strong>cookies</strong></td>",s+="<td><strong>描述</strong></td>",s+="<td><strong>监控频率</strong></td>",s+="<td><strong>添加时间</strong></td>",s+="<td><strong>操作</strong></td>",s+="</tr>";for(var i=0;i<len;++i)s+="<tr>",s+="<td class = 'url'>"+val[i].url+"</td>",s+="<td class = 'cookie'>"+val[i].cookie+"</td>",s+="<td class = 'desc'>"+val[i].desc+"</td>",s+="<td class = 'hz'>"+val[i].hzd+"</td>",s+="<td class = 'date'>"+val[i].date+"</td>",s+="<td style = 'text-align:center'>",s+="<button style = 'margin-right:4px' class = 'btn btn-default btn-xs del' onclick = 'inputinfo(\""+val[i].date+"\",event)'>编辑</button>",s+="<button style = 'margin-right:4px' class = 'btn btn-danger btn-xs del' onclick = 'delinfo(\""+val[i].date+"\")'>删除</button>",s+="</td>",s+="</tr>";obj.getTagName("table")[0].innerHTML=s}},xhr.open(method,url),xhr.send()}function modalshow(){$("#myModal").modal("show"),obj.getId("checkbox").onclick=cookieshow,$(".send").attr("id","send"),obj.getId("send").onclick=send()}function cookieshow(){$("#cookies").toggle()}function send(e,t,a){function n(n){var r=obj.getId("url").value,o=obj.getId("cookie").value,s=obj.getId("hz").value,d=obj.getId("date").value,i=obj.getId("desc").value,l=o.match(/(.*?)=(.*?)($|;)/g),c=r.match(/^((https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/);n||window.event;var u=n.scrElement?n.scrElement:n.target;if(""==r||""==d)alert("请填写必要的数据");else if(null==c)alert("请输入正确的URL");else if("none"!=obj.getId("cookies").style.display)if(null==l)alert("请输入正确的cookie格式");else if(""==s)alert("请输入频率值");else if(s=parseInt(s),arr=new Array(c[0],l,i,s+d,getDate()),obj.getClassName("send")[0].setAttribute("data-dismiss","modal"),"send"===u.id){var g="url="+arr[0]+"&cookie="+arr[1]+"&desc="+arr[2]+"&hzd="+arr[3]+"&date="+arr[4];ajaxop("post","?p=back&c=admin&act=insert_url",g)}else{for(var m=0;m<t.length;++m)obj.getClassName(t[m])[a-1].innerHTML=arr[m];var g="url="+arr[0]+"&cookie="+arr[1]+"&desc="+arr[2]+"&hzd="+arr[3]+"&date="+e;ajaxop("post","?p=back&c=admin&act=update_url",g)}else if("none"==obj.getId("cookies").style.display)if(""==s)alert("请输入频率值");else if(s=parseInt(s),arr=new Array(c[0],l,i,s+d,getDate()),obj.getClassName("send")[0].setAttribute("data-dismiss","modal"),"send"===u.id){var g="url="+arr[0]+"&cookie="+arr[1]+"&desc="+arr[2]+"&hzd="+arr[3]+"&date="+arr[4];ajaxop("post","?p=back&c=admin&act=insert_url",g)}else{for(var m=0;m<t.length;++m)obj.getClassName(t[m])[a-1].innerHTML=arr[m];var g="url="+arr[0]+"&cookie="+arr[1]+"&desc="+arr[2]+"&hzd="+arr[3]+"&date="+e;ajaxop("post","?p=back&c=admin&act=update_url",g)}}return n}function getDate(){var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDay()+21,r=e.getHours(),o=e.getMinutes(),s=e.getSeconds();return s<10&&(s="0"+s),r<10&&(r="0"+r),a<10&&(a="0"+a),n<10&&(n="0"+n),o<10&&(o="0"+o),t+"-"+a+"-"+n+" "+r+":"+o+":"+s}function ajaxop(e,t,a){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&(alert(n.responseText),numinfo(),ajaxshow("get","?p=back&c=admin&act=select_url_name"))},n.open(e,t),n.setRequestHeader("content-type","application/x-www-form-urlencoded"),n.send(a)}function inputinfo(e,t){$("#myModal").modal("show"),$(".send").attr("id","send1");var a=t.srcElement?t.srcElement:t.target;id=a.parentElement.parentNode.rowIndex;for(var n=["url","cookie","desc","hz"],r=0;r<n.length;++r)obj.getId(n[r]).value=obj.getClassName(n[r])[id-1].innerHTML;obj.getId("send1").onclick=send(e,n,id)}function delinfo(e){if(confirm("你真的要删除吗?")){ajaxop("post","?p=back&c=admin&act=delete_url","date="+e)}}function numinfo(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(obj.getClassName("num")[0].innerHTML="URL配置仅能添加 10 条，当前您已添加 "+e.responseText+" 条。")},e.open("get","?p=back&c=admin&act=show_url_num"),e.send()}var obj=new getinfo;window.onload=function(){obj.getId("cookies").style.display="none",ajaxshow("get","?p=back&c=admin&act=select_url_name"),numinfo(),obj.getId("key").onclick=modalshow};