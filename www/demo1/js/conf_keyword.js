function getinfo(){this.getId=function(e){return document.getElementById(e)},this.getClassName=function(e){return document.getElementsByClassName(e)},this.getTagName=function(e){return document.getElementsByTagName(e)},this.createTag=function(e){return document.createElement(e)},this.createText=function(e){return document.createTextNode(e)}}function showword(){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4==xhr.readyState){eval("var arr = "+xhr.responseText);var len=arr.length,s="<tr>";s+="<td>名称</td>",s+="<td>类型</dt>",s+="<td>创建时间</dt>",s+="<td>操作</td>",s+="</tr>";for(var i=0;i<len;++i)s+="<tr>",s+="<td style = 'width:350px'><span>"+arr[i].key_word+"</span><input type = 'text' class = 'form-control' style = 'display :none;'></td>",s+="<td><span>"+arr[i].type+"</span><input type = 'text' class = 'form-control' style = 'display :none;'></td>",s+="<td>&nbsp;</td>",s+="<td style = 'text-align:center'>",s+="<button style = 'margin-right:4px' class = 'btn btn-danger btn-xs del'>删除</button>",s+="<button style = 'margin-right:4px' class = 'btn btn-success btn-xs pre'>保存</button>",s+="</td>",s+="</tr>";obj.getTagName("table")[0].innerHTML=s,operation()}},xhr.open("get","?p=back&c=admin&act=info_details"),xhr.send(null)}function createKey(){if(11==obj.getTagName("tr").length)return alert("该页面最多支持10个关键字！");trObj=obj.createTag("tr");obj.getId("key_table");obj.getTagName("tbody")[0].appendChild(trObj),createtd1()}function createtd1(){var e=obj.createTag("td"),t=obj.createTag("span"),n=obj.createTag("input");trObj.appendChild(e),e.appendChild(t),e.appendChild(n),e.width="350px;",n.setAttribute("class","form-control"),n.type="text",n.setAttribute("maxlength","32"),e.style.border="1px solid #dddddd",n.focus(),createtype()}function createtype(){var e=obj.createTag("td"),t=obj.createTag("span"),n=obj.createTag("input");trObj.appendChild(e),e.appendChild(t),e.appendChild(n),e.width="350px;",n.setAttribute("class","form-control"),n.type="text",n.setAttribute("maxlength","32"),n.setAttribute("placeholder","输入类型为baidu或github"),e.style.border="1px solid #dddddd",createtd2()}function createtd2(){var e=obj.createTag("td"),t=obj.createText(getDate());trObj.appendChild(e),e.appendChild(t),e.style.border="1px solid #dddddd",createtd3()}function createtd3(){var e=obj.createTag("td");e.style.textAlign="center";for(var t=["删除","保存"],n=["btn-danger","btn-success"],a=["del","pre"],r=t.length,d=0;d<r;d++){var o=obj.createText(t[d]),s=obj.createTag("button");s.setAttribute("class","btn "+n[d]+" btn-xs "+a[d]),s.value=t[d],s.type="button",s.style.marginRight="4px",e.appendChild(s),s.appendChild(o)}trObj.appendChild(e),e.style.border="1px solid #dddddd",operation()}function getDate(){var e=new Date,t=e.getFullYear(),n=e.getMonth()+1,a=e.getDay(),r=e.getHours(),d=e.getMinutes(),o=e.getSeconds();return o<10&&(o="0"+o),r<10&&(r="0"+r),n<10&&(n="0"+n),a<10&&(a="0"+a),d<10&&(d="0"+d),t+"-"+n+"-"+a+" "+r+":"+d+":"+o}function operation(){for(var e=obj.getClassName("del"),t=obj.getClassName("pre"),n=e.length,a=0;a<n;++a)e[a].onclick=f1(a),t[a].onclick=f2(a)}function f1(e){function t(e){if(window.confirm("你真的要删除吗？")){var t=e.srcElement?e.srcElement:e.target,n=obj.getTagName("tr")[t.parentElement.parentNode.rowIndex],a=obj.getTagName("tbody")[0];"none"!=n.getElementsByTagName("input")[0].style.display||"none"!=n.getElementsByTagName("input")[1].style.display?a.removeChild(n):delword(n.getElementsByTagName("span")[0].innerHTML,n.getElementsByTagName("span")[1].innerHTML,t.parentElement.parentNode.rowIndex)}}return t}function f2(e){function t(e){var t=e.srcElement?e.srcElement:e.target,n=obj.getTagName("tr")[t.parentElement.parentNode.rowIndex].getElementsByTagName("span")[0],a=obj.getTagName("tr")[t.parentElement.parentNode.rowIndex].getElementsByTagName("span")[1],r=obj.getTagName("tr")[t.parentElement.parentNode.rowIndex].getElementsByTagName("input")[0],d=obj.getTagName("tr")[t.parentElement.parentNode.rowIndex].getElementsByTagName("input")[1];if("none"==r.style.display||"none"==d.style.display)alert("你的关键字已经保存");else if(""==r.value||null==r.value)alert("输入的关键字名称不能为空！"),r.focus();else if(""==d.value||null==d.value)alert("输入的关键字类型不能为空！"),d.focus();else{n.innerHTML=r.value,a.innerHTML=d.value,r.style.display="none",d.style.display="none";var t=e.srcElement?e.srcElement:e.target;selectword(n.innerHTML,a.innerHTML,r,d,n,a,t.parentElement.parentNode.rowIndex)}}return t}function selectword(e,t,n,a,r,d,o){var s=new XMLHttpRequest;s.onreadystatechange=function(){4==s.readyState&&(s.responseText>=1?(r.innerHTML="",d.innerHTML="",n.style.display="block",a.style.display="block",n.focus(),alert("该类型的关键字已经存在")):addword(e,t))},s.open("get","?p=back&c=admin&act=keyword_select&name="+e+"&type="+t),s.send(null)}function addword(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState&&alert(n.responseText)},n.open("get","?p=back&c=admin&act=keyword_add&name="+e+"&type="+t),n.send(null)}function delword(e,t,n){var a=new XMLHttpRequest;e=encodeURIComponent(e),a.onreadystatechange=function(){4==a.readyState&&("删除成功!"===a.responseText?(showword(),alert(a.responseText)):alert(a.responseText))},a.open("get","?p=back&c=admin&act=info_keyword_delete&name="+e+"&type="+t),a.send(null)}var obj=new getinfo;window.onload=function(){showword(),obj.getId("keyw").onclick=createKey};